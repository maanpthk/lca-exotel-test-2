#  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
#  SPDX-License-Identifier: Apache-2.0

VERSION_FILE ?= ../VERSION
AWS_REGION ?= us-east-1
RELEASE_S3_BUCKET := $(RELEASE_S3_BUCKET_BASE)-$(AWS_REGION)
RELEASE_S3_PREFIX ?= release
RELEASE_VERSION ?= $(shell cat $(VERSION_FILE))

SAGEMAKER_STACK_TEMPLATE := sagemaker-summary-stack.yaml
RELEASE_TEMPLATE_SAGEMAKER_S3_URL := s3://$(RELEASE_S3_BUCKET)/$(RELEASE_S3_PREFIX)/$(RELEASE_VERSION)/$(SAGEMAKER_STACK_TEMPLATE)

sagemaker-stack: $(SAGEMAKER_STACK_TEMPLATE)
	echo '[INFO] uploading $(SAGEMAKER_STACK_TEMPLATE) to $(RELEASE_TEMPLATE_SAGEMAKER_S3_URL)'
	aws s3 cp '$(SAGEMAKER_STACK_TEMPLATE)' '$(RELEASE_TEMPLATE_SAGEMAKER_S3_URL)'

BEDROCK_BOTO3_STACK_TEMPLATE := bedrock-preview-boto3-stack.yaml
RELEASE_TEMPLATE_BEDROCK_BOTO3_S3_URL := s3://$(RELEASE_S3_BUCKET)/$(RELEASE_S3_PREFIX)/$(RELEASE_VERSION)/$(BEDROCK_BOTO3_STACK_TEMPLATE)

bedrock-boto3-stack: $(BEDROCK_BOTO3_STACK_TEMPLATE)
	echo '[INFO] uploading $(BEDROCK_BOTO3_STACK_TEMPLATE) to $(RELEASE_TEMPLATE_BEDROCK_BOTO3_S3_URL)'
	aws s3 cp '$(BEDROCK_BOTO3_STACK_TEMPLATE)' '$(RELEASE_TEMPLATE_BEDROCK_BOTO3_S3_URL)'

release: sagemaker-stack bedrock-boto3-stack
.PHONY: release